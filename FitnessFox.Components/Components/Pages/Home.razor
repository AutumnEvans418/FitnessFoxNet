@page "/"
@using FitnessFox.Components.Services
@using FitnessFox.Components.ViewModels
@using FitnessFox.Data.Goals
@using FitnessFox.Data.Vitals

@attribute [Authorize]
@inject ApplicationDbContext dbContext
@inject ISnackbar Snackbar
@inject IAuthenticationService authenticationService
@inject ISettingsService settingsService
@inject IGoogleSyncService googleSyncService
@inherits ViewModelComponentBase<HomeViewModel>
<PageTitle>Home</PageTitle>
<MudGrid>
    <MudItem xs="12" sm="12" md="12">
        <MudPaper Elevation="2" Class="pa-4" Style="height: 100px;">
            <MudText Typo="Typo.h6">Current Date</MudText>
            <MudStack Row=true>
                <MudIconButton Disabled=Vm.IsLoading OnClick="() => Vm.Load(() => Vm.SetDate(Vm.CurrentDate?.AddDays(-1)))" Icon="@Icons.Material.Filled.ArrowLeft"></MudIconButton>
                <MudDatePicker Disabled=Vm.IsLoading @bind-Date="Vm.CurrentDate" @bind-Date:after="() => Vm.Load(Vm.Refresh)"></MudDatePicker>
                <MudIconButton Disabled=Vm.IsLoading OnClick="() => Vm.Load(() => Vm.SetDate(Vm.CurrentDate?.AddDays(1)))" Icon="@Icons.Material.Filled.ArrowRight"></MudIconButton>
            </MudStack>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Elevation="2" Class="pa-4">
            <MudText Typo="Typo.h6">Weight</MudText>
            <MudStack Row=true>
                <MudNumericField Disabled=Vm.IsLoading T="float" 
                    @bind-Value="Vm.Weight.Value" 
                    @bind-Value:after="() => Vm.Load(() => Vm.Save(Vm.Weight))" Label="Weight"></MudNumericField>
                @if (Vm.User.HeightInches > 0)
                {
                    <MudText Align="Align.Center">BMI @FitnessExtensions.Bmi(Vm.Weight.Value, Vm.User.HeightInches)</MudText>
                }
                @if (Vm.WeightGoal != null && MathF.Round(Vm.Weight.Value - Vm.WeightGoal.Value) > 0)
                {
                    <MudText Align="Align.Center">Goal Weight: @Vm.WeightGoal.Value (@MathF.Round(Vm.Weight.Value - Vm.WeightGoal.Value)lbs to go)</MudText>
                }

            </MudStack>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Elevation="2" Class="pa-4">
            <MudText Typo="Typo.h6">Blood</MudText>
            <MudStack Row=true>
                <MudNumericField Disabled=Vm.IsLoading T="float" @bind-Value="Vm.Systolic.Value"  @bind-Value:after="() => Vm.Load(() => Vm.Save(Vm.Systolic))" Label="Systolic"></MudNumericField>
                <MudNumericField Disabled=Vm.IsLoading T="float" @bind-Value="Vm.Diastolic.Value" @bind-Value:after="() => Vm.Load(() => Vm.Save(Vm.Diastolic))" Label="Diastolic"></MudNumericField>
                <MudNumericField Disabled=Vm.IsLoading T="float" @bind-Value="Vm.Bpm.Value"       @bind-Value:after="() => Vm.Load(() => Vm.Save(Vm.Bpm))" Label="Bpm"></MudNumericField>
            </MudStack>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Elevation="2" Class="pa-4">
            <MudText Typo="Typo.h6">Temperature</MudText>
            <MudNumericField Disabled=Vm.IsLoading T="float" @bind-Value="Vm.Temperature.Value" @bind-Value:after="() => Vm.Load(() => Vm.Save(Vm.Temperature))" Label="Temp"></MudNumericField>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Elevation="2" Class="pa-4">
            <MudText Typo="Typo.h6">Water</MudText>
            <MudNumericField Disabled=Vm.IsLoading T="float" @bind-Value="Vm.Water.Value" @bind-Value:after="() => Vm.Load(() => Vm.Save(Vm.Water))" Label="Water (fl ounces)"></MudNumericField>
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="6" md="4">
        <MudPaper Elevation="2" Class="pa-4">
            <MudText Typo="Typo.h6">Height</MudText>
            <MudNumericField Disabled=Vm.IsLoading T="float" @bind-Value="Vm.User.HeightInches" @bind-Value:after="() => Vm.Load(() => dbContext.SaveChangesAsync())" Label="Height Inches"></MudNumericField>
        </MudPaper>
    </MudItem>
</MudGrid>
