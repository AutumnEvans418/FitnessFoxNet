@page "/recipes"
@using FitnessFox.Components.ViewModels
@using FitnessFox.Data.Foods
@attribute [Authorize]
@inject ApplicationDbContext dbContext
@inject AuthenticationStateProvider stateProvider
@inject ISnackbar Snackbar
@inherits ViewModelComponentBase<RecipesViewModel>
@inject NavigationManager navigationManager
<MudDataGrid @ref="dataGrid" RowClick="@(r => navigationManager.NavigateTo($"/recipes/{r.Item.Id}"))" T="Recipe" ServerData="Vm.ServerReload" Filterable="false">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Recipes</MudText>
        <MudButton Disabled=Vm.IsLoading Color="Color.Primary"
                   Variant="Variant.Filled"
                   Size="Size.Small"
                   Style="margin:5px" Href="/recipes/add">+</MudButton>
        <MudSpacer />
        <MudTextField T="string" ValueChanged="@(s => Vm.OnSearch(s))" Placeholder="Search" Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <Columns>
        <PropertyColumn Property="x => x.Name" Title="Name" />
        <PropertyColumn Property="x => x.NumberOfPeople" Title="Number of People" />
        <PropertyColumn Property="x => x.User.UserName" Title="Created By" />
        <PropertyColumn Property="x => x.Calories" />
        <PropertyColumn Property="x => x.Sodium" />
        <PropertyColumn Property="x => x.Cholesterol" />
    </Columns>
    <PagerContent>
        <MudDataGridPager T="Food" />
    </PagerContent>
</MudDataGrid>
@code {
    private MudDataGrid<Recipe>? dataGrid;

    protected override void OnAfterRender(bool firstRender)
    {
        if (dataGrid != null)
            Vm.ReloadServerData = dataGrid.ReloadServerData;
        base.OnAfterRender(firstRender);
    }
}