@page "/foods"
@using FitnessFox.Components.ViewModels.Foods
@using FitnessFox.Data.Foods
@attribute [Authorize]
@inherits ViewModelComponentBase<FoodIndexViewModel>
@inject NavigationManager navigationManager

<MudDataGrid @ref="dataGrid" RowClick="@(r => navigationManager.NavigateTo($"/foods/{r.Item.Id}"))" T="Food" ServerData="Vm.ServerReload" Filterable="false">
    <ToolBarContent>
        <MudText Typo="Typo.h6">Foods</MudText>
        <MudButton Color="Color.Primary" 
            Variant="Variant.Filled" 
            Size="Size.Small" 
            Style="margin:5px" Href="/foods/add">+</MudButton>
        <MudSpacer />
        <MudTextField T="string" ValueChanged="@(s => Vm.OnSearch(s))" Placeholder="Search" Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Search" IconSize="Size.Medium" Class="mt-0"></MudTextField>
    </ToolBarContent>
    <Columns>
        <PropertyColumn Property="x => x.BrandRestaurant" Title="Branch/Restaurant" />
        <PropertyColumn Property="x => x.Description" />
        <PropertyColumn Property="x => x.ServingSize" />
        <PropertyColumn Property="x => x.ServingUnit" />
        <PropertyColumn Property="x => x.TotalServings" />
        <PropertyColumn Property="x => x.Calories" />
        <PropertyColumn Property="x => x.Sodium" />
        <PropertyColumn Property="x => x.Cholesterol" />
    </Columns>
    <PagerContent>
        <MudDataGridPager T="Food" />
    </PagerContent>
</MudDataGrid>
@code {
    private MudDataGrid<Food>? dataGrid;

    protected override void OnAfterRender(bool firstRender)
    {
        if(dataGrid != null)
            Vm.ReloadServerData = dataGrid.ReloadServerData;
        base.OnAfterRender(firstRender);
    }

}
